@{
    string userId = ViewBag.UserId;
    string userRole = ViewBag.UserRole;
}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Furniure</title>
    <script type="importmap"></script>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/WebApplication1.styles.css" asp-append-version="true" />
    <script src="~/ckeditor/ckeditor.js"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>

    <style>
        .nav-link[aria-expanded="true"] .bi-chevron-down {
            transform: rotate(180deg);
            transition: transform 0.2s ease;
        }
    </style>

</head>
<body>
    <div class="">
        <div class="row">
            @if (!string.IsNullOrEmpty(userId))
        {
                @if (userRole.Equals("admin") || userRole.Equals("employee"))
                {
                     <nav class="sidebar sidebar-custom col-10 col-md-3 col-lg-2 d-md-block p-0 position-fixed" style="width: 250px; height: 100vh; left: 0; top: 0; z-index: 1030; background: #fff;"> 
                        <div class="position-sticky pt-3">
                            <div class="text-center mb-2">
                                <img src="~/images/logo.png" alt="Logo" class="img-fluid rounded-circle" style="max-width: 80px;" />
                            </div>
                            <ul class="nav flex-column">
                                <!-- Trang chủ -->
                                <li class="nav-item">
                                    <a class="nav-link @(ViewContext.RouteData.Values["controller"]?.ToString() == "AdminHome" ? "active" : "")"
                                       asp-area="" asp-controller="AdminHome" asp-action="Index">
                                        <i class="bi bi-house-door me-2"></i>Trang chủ
                                    </a>
                                </li>

                                <!-- Sản phẩm -->
                                <li class="nav-item">
                                    <a class="nav-link @(ViewContext.RouteData.Values["controller"]?.ToString() == "AdminProduct" ? "active" : "")"
                                       asp-area="" asp-controller="AdminProduct" asp-action="Index">
                                        <i class="bi bi-box-seam me-2"></i>Sản phẩm
                                    </a>
                                </li>

                                <!-- Danh mục -->
                                <li class="nav-item">
                                    <a class="nav-link @(ViewContext.RouteData.Values["controller"]?.ToString() == "AdminCategory" ? "active" : "")"
                                       asp-area="" asp-controller="AdminCategory" asp-action="Index">
                                        <i class="bi bi-bookmark me-2"></i>Danh mục
                                    </a>
                                </li>

                                <!-- Nhãn -->
                                <li class="nav-item">
                                    <a class="nav-link @(ViewContext.RouteData.Values["controller"]?.ToString() == "AdminTag" ? "active" : "")"
                                       asp-area="" asp-controller="AdminTag" asp-action="Index">
                                        <i class="bi bi-tag me-2"></i>Nhãn
                                    </a>
                                </li>

                                <!-- Người dùng -->
                                <li class="nav-item">
                                    <a class="nav-link @(ViewContext.RouteData.Values["controller"]?.ToString() == "AdminUser" ? "active" : "")"
                                       asp-area="" asp-controller="AdminUser" asp-action="Index">
                                        <i class="bi bi-people me-2"></i>Người dùng
                                    </a>
                                </li>

                                <!-- Đơn hàng -->
                                <li class="nav-item">
                                    <a class="nav-link @(ViewContext.RouteData.Values["controller"]?.ToString() == "Order" ? "active" : "")"
                                       asp-area="" asp-controller="AdminOrder" asp-action="Index">
                                        <i class="bi bi-cart-check me-2"></i>Đơn hàng
                                    </a>
                                </li>

                                <!-- Khuyến mãi -->
                                <li class="nav-item">
                                    <a class="nav-link @(ViewContext.RouteData.Values["controller"]?.ToString() == "Promotion" ? "active" : "")"
                                       asp-area="" asp-controller="AdminPromotion" asp-action="Index">
                                        <i class="bi bi-megaphone me-2"></i>Khuyến mãi
                                    </a>
                                </li>

                                <!-- Mã giảm giá -->
                                <li class="nav-item">
                                    <a class="nav-link @(ViewContext.RouteData.Values["controller"]?.ToString() == "Voucher" ? "active" : "")"
                                       asp-area="" asp-controller="AdminVoucher" asp-action="Index">
                                        <i class="bi bi-ticket-perforated me-2"></i>Mã giảm giá
                                    </a>
                                </li>

                                <!-- Bài viết -->
                                <li class="nav-item">
                                    <a class="nav-link @(ViewContext.RouteData.Values["controller"]?.ToString() == "Post" ? "active" : "")"
                                       asp-area="" asp-controller="AdminPost" asp-action="Index">
                                        <i class="bi bi-file-earmark-text me-2"></i>Bài viết
                                    </a>
                                </li>

                                <!-- Phân loại bài viết -->
                                <li class="nav-item">
                                    <a class="nav-link @(ViewContext.RouteData.Values["controller"]?.ToString() == "PostCategory" ? "active" : "")"
                                       asp-area="" asp-controller="PostCategory" asp-action="Index">
                                        <i class="bi bi-journal-text me-2"></i>Chuyên mục bài viết
                                    </a>
                                </li>

                                <!-- Quản trị hệ thống -->
                                <li class="nav-item">
                                    <a class="nav-link @(ViewContext.RouteData.Values["controller"]?.ToString() == "System" ? "active" : "")"
                                       asp-area="" asp-controller="System" asp-action="Settings">
                                        <i class="bi bi-gear me-2"></i>Cài đặt hệ thống
                                    </a>
                                </li>
                            </ul>

                        </div>
                    </nav>

                        <main class="" style="margin-left: 250px; background-color:#f5f6fa; max-width: calc(100vw - 250px - 30px);">
                            <header class="shadow-sm" style="background-color:#ffffff">
                                <nav class="navbar navbar-expand-lg navbar-light">
                                    <div class="container-fluid">
                                        <!-- Logo -->
                                        <a class="navbar-brand fw-bold text-dark ms-5" asp-area="" asp-controller="Home" asp-action="Index">SweetUIFurniture</a>

                                        <!-- Toggle for mobile -->
                                        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent">
                                            <span class="navbar-toggler-icon"></span>
                                        </button>

                                        <!-- Main navbar content -->
                                        <div class="collapse navbar-collapse" id="navbarContent">
                                            <span class="navbar-text ms-auto me-3 fw-semibold">Dashboard</span>

                                            <!-- Dark mode toggle -->
                                            <div class="form-check form-switch me-3">
                                                <input class="form-check-input" type="checkbox" id="darkModeToggle" />
                                                <label class="form-check-label" for="darkModeToggle">Dark Mode</label>
                                            </div>

                                            <!-- User dropdown -->
                                            @if (!string.IsNullOrEmpty(userId))
                                            {
                                                <div class="dropdown">
                                                    <a href="#" class="d-flex align-items-center text-dark text-decoration-none dropdown-toggle" id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                                        <img src="/images/avatar.png" alt="avatar" width="32" height="32" class="rounded-circle me-2" />
                                                        <strong>@ViewBag.Name</strong>
                                                    </a>
                                                    <ul class="dropdown-menu dropdown-menu-end text-small shadow" aria-labelledby="userDropdown">
                                                        <li><a class="dropdown-item" asp-controller="User" asp-action="Profile">Hồ sơ</a></li>
                                                        <li><hr class="dropdown-divider"></li>
                                                        <li><form method="post" asp-controller="User" asp-action="Logout">
                                                            <button class="dropdown-item" type="submit">Đăng xuất</button>
                                                        </form>
                                                        </li>
                                                    </ul>
                                                </div>
                                            }
                                            else
                                            {
                                                <a class="btn btn-outline-primary ms-3" asp-controller="User" asp-action="SignIn">Đăng nhập</a>
                                            }
                                        </div>
                                    </div>
                                </nav>
                            </header>
                            <div class="main-content" style="">
                                @RenderBody()
                            </div>
                            @* <footer class="shadow-sm" style="background-color:#ffffff">
                                <nav class="navbar navbar-expand-lg navbar-light">
                                    <div class="container-fluid">
                                        No copyright!
                                    </div>
                                </nav>
                            </footer> *@
                    </main>
                }
                else
                {
                    <nav class="navbar navbar-expand-lg">
                        <div class="container-fluid">
                            <div class="d-flex justify-content-between align-items-center w-100 mx-3 py-2">
                                <div class="collapse navbar-collapse" id="navbarNav">
                                    <ul class="navbar-nav">
                                        <li>
                                            <img src="~/images/logo.png" alt="Logo" class="img-fluid rounded-circle" style="max-width: 40px;" />
                                        </li>
                                    </ul>
                                    <ul class="navbar-nav me-auto mb-2 mb-lg-0 d-flex justify-content-center w-100">
                                        <li class="nav-item mx-2">
                                            <a class="nav-link active" aria-current="page" href="/">Trang chủ</a>
                                        </li>
                                        <li class="nav-item mx-2">
                                            <a class="nav-link" asp-controller="Support" asp-action="About">Giới thiệu</a>
                                        </li>
                                        <li class="nav-item mx-2">
                                            <a class="nav-link" asp-controller="Product" asp-action="">Sản phẩm</a>
                                        </li>
                                        <li class="nav-item mx-2">
                                            <a class="nav-link" asp-controller="Category" asp-action="">Danh mục</a>
                                        </li>
                                        <li class="nav-item mx-2">
                                            <a class="nav-link" asp-controller="Support" asp-action="Contact">Liên hệ</a>
                                        </li>
                                    </ul>
                                    <ul class="navbar-nav">
                                        <li class="nav-item mx-2">
                                            <a class="nav-link text-nowrap" asp-controller="User" asp-action="SignIn">Đăng nhập</a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </nav>

                    <!-- Nếu chưa đăng nhập, chỉ hiển thị nội dung trang (RenderBody) -->
                    <main class="main-content" style="background-color:#f5f6fa">
                        @RenderBody()
                    </main>
                    <footer class="footer py-2 bg-dark border-top text-light">
                        <div class="container d-flex flex-column flex-md-row justify-content-between align-items-center">
                            <div class="mb-2 mb-md-0">
                                <img src="~/images/logo.png" alt="Logo" style="height:40px;" class="me-2" />
                                <span class="fw-bold text-light">SweetUIFurniture</span>
                            </div>
                            <div class="mb-2 mb-md-0">
                                <a href="/" class="text-decoration-none text-light me-3">Trang chủ</a>
                                <a href="/Categories" class="text-decoration-none text-light me-3">Danh mục</a>
                                <a href="/Order" class="text-decoration-none text-light me-3">Đơn hàng</a>
                                <a href="/Promotion" class="text-decoration-none text-light">Khuyến mãi</a>
                            </div>
                            <div class="text-light small">
                                &copy; @DateTime.Now.Year SweetUIFurniture. All rights reserved.
                            </div>
                        </div>
                    </footer>
                }
            }
            else
            {
                @if (true)
                {
                    <nav class="navbar navbar-expand-lg">
                        <div class="container-fluid">
                            <div class="d-flex justify-content-between align-items-center w-100 mx-3 py-2">
                                <div class="collapse navbar-collapse" id="navbarNav">
                                    <ul class="navbar-nav">
                                        <li>
                                            <img src="~/images/logo.png" alt="Logo" class="img-fluid rounded-circle" style="max-width: 40px;" />
                                        </li>
                                    </ul>
                                    <ul class="navbar-nav me-auto mb-2 mb-lg-0 d-flex justify-content-center w-100">
                                        <li class="nav-item mx-2">
                                            <a class="nav-link active" aria-current="page" href="/">Trang chủ</a>
                                        </li>
                                        <li class="nav-item mx-2">
                                            <a class="nav-link" asp-controller="Support" asp-action="About">Giới thiệu</a>
                                        </li>
                                        <li class="nav-item mx-2">
                                            <a class="nav-link" asp-controller="Product" asp-action="">Sản phẩm</a>
                                        </li>
                                        <li class="nav-item mx-2">
                                            <a class="nav-link" asp-controller="Category" asp-action="">Danh mục</a>
                                        </li>
                                        <li class="nav-item mx-2">
                                            <a class="nav-link" asp-controller="Support" asp-action="Contact">Liên hệ</a>
                                        </li>
                                    </ul>
                                    <ul class="navbar-nav">
                                        <li class="nav-item mx-2">
                                            <a class="nav-link text-nowrap" asp-controller="User" asp-action="SignIn">Đăng nhập</a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </nav>

                    <!-- Nếu chưa đăng nhập, chỉ hiển thị nội dung trang (RenderBody) -->
                    <main class="main-content" style="background-color:#f5f6fa">
                        @RenderBody()
                    </main>
                    <footer class="footer py-2 bg-dark border-top text-light">
                        <div class="container d-flex flex-column flex-md-row justify-content-between align-items-center">
                            <div class="mb-2 mb-md-0">
                                <img src="~/images/logo.png" alt="Logo" style="height:40px;" class="me-2" />
                                <span class="fw-bold text-light">SweetUIFurniture</span>
                            </div>
                            <div class="mb-2 mb-md-0">
                                <a href="/" class="text-decoration-none text-light me-3">Trang chủ</a>
                                <a href="/Categories" class="text-decoration-none text-light me-3">Danh mục</a>
                                <a href="/Order" class="text-decoration-none text-light me-3">Đơn hàng</a>
                                <a href="/Promotion" class="text-decoration-none text-light">Khuyến mãi</a>
                            </div>
                            <div class="text-light small">
                                &copy; @DateTime.Now.Year SweetUIFurniture. All rights reserved.
                            </div>
                        </div>
                    </footer>
                }
                else
                {
                    <div class="main-content">
                        @RenderBody()
                    </div>
                }
        }
        </div>
    </div>

    @* <footer class="border-top footer text-muted">
        <div class="container">
            &copy; 2025 - WebApplication1 - <a asp-area="" asp-controller="Home" asp-action="Privacy">Privacy</a>
        </div>
    </footer> *@
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>
    @await RenderSectionAsync("Scripts", required: false)

    @if (TempData["Success"] != null)
    {
        <div id="toast-success" class="toast toast-success show" style="position: fixed; top: 20px; right: 20px; z-index: 9999;">
            @TempData["Success"]
        </div>
    }
    @if (TempData["Error"] != null)
    {
        <div id="toast-error" class="toast toast-error show" style="position: fixed; top: 20px; right: 20px; z-index: 9999;">
            @TempData["Error"]
        </div>
    }
    <script>
        setTimeout(function() {
            document.getElementById('toast-success')?.remove();
            document.getElementById('toast-error')?.remove();
        }, 2500);
    </script>
</body>
</html>
